"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2452],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,h=p["".concat(l,".").concat(d)]||p[d]||m[d]||r;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},30733:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(87462),a=(n(67294),n(3905));const r={slug:"2023-day22",title:"22. Power Automate, ACS and OpenAI",authors:["milan","david","daysha"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["low code","developer tools","power platform","power automate","azure communication services","30DaysOfLowCode"],image:"https://microsoft.github.io/Low-Code/img/og/30-22.png",description:"Learn how to build a SMS conversational bot with Power Automate, OpenAI and Azure Communication Services! - join us at #LowCodeFebruary https://aka.ms/lowcode-february. #30DaysOfLowCode",tags:["low code","developer tools","power platform","power automate","azure communication services","30DaysOfLowCode"]},i=void 0,s={permalink:"/Low-Code/blog/2023-day22",source:"@site/blog/2023-lcf/2023-02-22/01-acs-sms-bot.md",title:"22. Power Automate, ACS and OpenAI",description:"Learn how to build a SMS conversational bot with Power Automate, OpenAI and Azure Communication Services! - join us at #LowCodeFebruary https://aka.ms/lowcode-february. #30DaysOfLowCode",date:"2023-02-22T00:00:00.000Z",formattedDate:"February 22, 2023",tags:[{label:"low code",permalink:"/Low-Code/blog/tags/low-code"},{label:"developer tools",permalink:"/Low-Code/blog/tags/developer-tools"},{label:"power platform",permalink:"/Low-Code/blog/tags/power-platform"},{label:"power automate",permalink:"/Low-Code/blog/tags/power-automate"},{label:"azure communication services",permalink:"/Low-Code/blog/tags/azure-communication-services"},{label:"30DaysOfLowCode",permalink:"/Low-Code/blog/tags/30-days-of-low-code"}],readingTime:6.005,hasTruncateMarker:!1,authors:[{name:"Milan Kaur",title:"Software Engineer II",url:"https://www.linkedin.com/in/milankaurintech/",imageURL:"https://media.licdn.com/dms/image/D4D03AQHpkA2SsnkQXQ/profile-displayphoto-shrink_400_400/0/1673088306949?e=1682553600&v=beta&t=wTXCTb9T8BBBU6qtpp73KGuyDcB8UPAcprYeVI1Uijs",key:"milan"},{name:"David de Matheu",title:"Senior Product Manager",url:"https://www.linkedin.com/in/ddematheu/",imageURL:"https://media.licdn.com/dms/image/C5603AQFxbBVgSJywUg/profile-displayphoto-shrink_400_400/0/1643603250406?e=1682553600&v=beta&t=4hru8D3pT2SJ44PpgGPiEyXvsMvE5gzqdLOLM8eVDlk",key:"david"},{name:"Daysha Carter",title:"Principal Product Manager",url:"https://www.linkedin.com/in/dayshacarter/",imageURL:"https://media.licdn.com/dms/image/C4D03AQFcUwDMgDAX6g/profile-displayphoto-shrink_400_400/0/1516629468930?e=1682553600&v=beta&t=9-pB-4Q9VBKgb8RXtb-uGqMXJYU0Tx5zXz6lrtHFDvA",key:"daysha"}],frontMatter:{slug:"2023-day22",title:"22. Power Automate, ACS and OpenAI",authors:["milan","david","daysha"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["low code","developer tools","power platform","power automate","azure communication services","30DaysOfLowCode"],image:"https://microsoft.github.io/Low-Code/img/og/30-22.png",description:"Learn how to build a SMS conversational bot with Power Automate, OpenAI and Azure Communication Services! - join us at #LowCodeFebruary https://aka.ms/lowcode-february. #30DaysOfLowCode",tags:["low code","developer tools","power platform","power automate","azure communication services","30DaysOfLowCode"]},prevItem:{title:"23. Power Platform and Governance",permalink:"/Low-Code/blog/2023-day23"},nextItem:{title:"21. GitHub Actions for Power",permalink:"/Low-Code/blog/2023-day21"}},l={authorsImageUrls:[void 0,void 0,void 0]},c=[{value:"What We&#39;ll Cover",id:"what-well-cover",level:2},{value:"Background",id:"background",level:2},{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Configuring Event Grid Trigger",id:"configuring-event-grid-trigger",level:2},{value:"Configure Azure OpenAI",id:"configure-azure-openai",level:2},{value:"Configure Azure Communication Services SMS",id:"configure-azure-communication-services-sms",level:2},{value:"Next Steps and Resources",id:"next-steps-and-resources",level:2}],u={toc:c};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("head",null,(0,a.kt)("meta",{name:"twitter:url",content:"https://microsoft.github.io/Low-Code/img/og/30-22.png"}),(0,a.kt)("meta",{name:"twitter:title",content:"22. Power Automate and ACS"}),(0,a.kt)("meta",{name:"twitter:description",content:"Learn how to build a SMS conversational bot with Power Automate, OpenAI and Azure Communication Services! - join us at #LowCodeFebruary https://aka.ms/lowcode-february. #30DaysOfLowCode"}),(0,a.kt)("meta",{name:"twitter:image",content:"https://microsoft.github.io/Low-Code/img/og/30-22.png"}),(0,a.kt)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,a.kt)("meta",{name:"twitter:creator",content:"@nitya"}),(0,a.kt)("meta",{name:"twitter:site",content:"@AzureAdvocates"}),(0,a.kt)("link",{rel:"canonical",href:"https://microsoft.github.io/Low-Code/img/og/30-22.png"})),(0,a.kt)("p",null,"Welcome to ",(0,a.kt)("inlineCode",{parentName:"p"},"Day 22")," of #30DaysOfLowCode!"),(0,a.kt)("h2",{id:"what-well-cover"},"What We'll Cover"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Power Automate and Azure Communication Services"),(0,a.kt)("li",{parentName:"ul"},"Build a SMS conversational bot"),(0,a.kt)("li",{parentName:"ul"},"Configuring Event Grid Trigger"),(0,a.kt)("li",{parentName:"ul"},"Configure Azure OpenAI"),(0,a.kt)("li",{parentName:"ul"},"Configure Azure Communication Services SMS"),(0,a.kt)("li",{parentName:"ul"},"Exercise: Sign up for your ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/lowcode-february/devplan"},(0,a.kt)("strong",{parentName:"a"},"Developer Plan"))),(0,a.kt)("li",{parentName:"ul"},"Resources: Explore the ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/lowcode-february/collection"},(0,a.kt)("strong",{parentName:"a"},"Low Code February Collection")))),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Feb22",src:n(37281).Z,width:"1334",height:"560"})),(0,a.kt)("h2",{id:"background"},"Background"),(0,a.kt)("p",null,"In our ",(0,a.kt)("a",{parentName:"p",href:"https://techcommunity.microsoft.com/t5/azure-communication-services/build-a-conversational-sms-bot-with-azure-communication-services/ba-p/3739568"},"last blog"),", we walked through the process of building a SMS conversational bot. Today we want to showcase a similar bot, but this time built completely on top of low code connectors for Power Automate. It is incredibly easy and exciting to leverage Azure Communication Services connectors in conjunction with Large Language Models (LLM) like ChatGPT to build a conversation bot. For this blog, we will be building Anton, a personal trainer bot for Contoso Gym. See the preview:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Anton Preview",src:n(76158).Z,width:"600",height:"600"})),(0,a.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("p",null,"To follow along you will need:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"An Azure account with an active subscription. ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-create-azure"},"Create an account for free"),"."),(0,a.kt)("li",{parentName:"ul"},"Enable Event Grid resource provided on your subscription. See ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-event-sub"},"instructions"),"."),(0,a.kt)("li",{parentName:"ul"},"An active Communication Services resource and connection string. ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-create-resource"},"Create")," a Communication Services resource."),(0,a.kt)("li",{parentName:"ul"},"An SMS-enabled telephone number. ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-get-number"},"Get a phone number"),"."),(0,a.kt)("li",{parentName:"ul"},"Azure OpenAI resource. See ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-create-open"},"instructions"),"."),(0,a.kt)("li",{parentName:"ul"},"Azure OpenAI deployed model. See ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-deploy-model"},"instructions"),"."),(0,a.kt)("li",{parentName:"ul"},"Power Automate account. Azure Communication Services connectors require a ",(0,a.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/power-platform/admin/power-automate-licensing/types#standalone-plans"},"plan")," that supports premium connectors.")),(0,a.kt)("h2",{id:"configuring-event-grid-trigger"},"Configuring Event Grid Trigger"),(0,a.kt)("p",null,"This application will leverage ",(0,a.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/azure/event-grid/"},"Azure Event Grid")," to listen for incoming text messages to Azure Communication Services number, and an ",(0,a.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/azure/azure-functions/"},"Azure Function")," to process the event and respond with an Azure OpenAI generated response."),(0,a.kt)("p",null,"We will start by configuring an Event Grid trigger for your Power Automate flow. This trigger will automatically connect to your existing Azure subscription and to the Azure Communication Services resource to configure your event subscription."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Event Grid Trigger",src:n(94847).Z,width:"1341",height:"808"})),(0,a.kt)("p",null,"To keep the data organized, you will add a Parse JSON connector to help us parse the event. The event schema follows this structure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<details>\n<summary><b>Schema (open to see)</b></summary>\n\n```json\n\n{\n    "properties": {\n        "data": {\n            "properties": {\n                "From": {\n                    "type": "string"\n                },\n                "Message": {\n                    "type": "string"\n                },\n                "MessageId": {\n                    "type": "string"\n                },\n                "ReceivedTimestamp": {\n                    "type": "string"\n                },\n                "To": {\n                    "type": "string"\n                }\n            },\n            "type": "object"\n        },\n        "dataVersion": {\n            "type": "string"\n        },\n        "eventTime": {\n            "type": "string"\n        },\n        "eventType": {\n            "type": "string"\n        },\n        "id": {\n            "type": "string"\n        },\n        "metadataVersion": {\n            "type": "string"\n        },\n        "subject": {\n            "type": "string"\n        },\n        "topic": {\n            "type": "string"\n        }\n    },\n    "type": "object"\n}\n\n```\n\n</details>\n')),(0,a.kt)("p",null,"Add that schema to the Parse JSON connector and add the event body as the content."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Parse JSON",src:n(52679).Z,width:"1258",height:"750"})),(0,a.kt)("h2",{id:"configure-azure-openai"},"Configure Azure OpenAI"),(0,a.kt)("p",null,"Next, we must add a call to Azure OpenAI to ask the model to generate a response. We will use REST APIs to POST a request with our prompt. For the prompt, we will use a combination of the message sent by the user and a pre-designed text. In this example, we want the GPT-3 model to act like Anton, a personal trainer at Contoso Gym. We added some sample quotes from which the model can draw inspiration. These quotes help guide the model\u2019s response and provide a more intuitive and conversational flow for the users. See the completed prompt below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"```text\n\n    You're Anton Stanescu and you are a personal trainer at Contoso Gym. You are having a conversation with one of your students. You are trying to motivate them to work out.\n    Examples of the types of things that Anton says:\n    - The only bad workout is the one that didn't happen.\n    - Strive for progress, not perfection.\n    - You won't get the muscle without the dedication and the drive\n    - Train hard...so you can stop a train if you need to.\n    - Push up, push down, push up, push down\n    - Exercise should be regarded as tribute to the heart.\n    Anton: Welcome to the Contoso Gym! Big things await for you.\n    Student:\n\n```\n")),(0,a.kt)("p",null,"To keep the flow organized, we will add a compose connector for our prompt so we can easily reference it later."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Compose Prompt",src:n(29535).Z,width:"1240",height:"864"})),(0,a.kt)("p",null,"To communicate with the Azure OpenAI service, we will use POST request inside of an HTTP connector. In return, we will receive a text generated by the Azure OpenAI model. To configure the HTTP connector, you will need the URI to your Azure OpenAI resource. You will also need the ",(0,a.kt)("inlineCode",{parentName:"p"},"api-key")," for your Azure OpenAI resource."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"```text\n\n<base_url> + /openai/deployments/ + <deployment_name> + /completions?api-version=2022-12-01\n\n```\n")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"HTTP Connector",src:n(44369).Z,width:"1030",height:"1013"})),(0,a.kt)("p",null,"Using the compose output for our prompt, we will concatenate together the prompt, the message the user sent through SMS, and a stop trigger for the Open AI model to stop generating text:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"```text\n\nconcat(outputs('Compose'), body('Parse_JSON')?['data']?['Message'], '\\nAnton:')\n\n```\n")),(0,a.kt)("p",null,"Once we have the HTTP connector configured, we will use a Parse JSON connector to process the response from Azure Open AI. The expected schema from Azure Open AI takes the following format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<details>\n<summary><b>Schema (open to see)</b></summary>\n\n```json\n\n{\n    "properties": {\n        "choices": {\n            "items": {\n                "properties": {\n                    "finish_reason": {\n                        "type": "string"\n                    },\n                    "index": {\n                        "type": "integer"\n                    },\n                    "logprobs": {},\n                    "text": {\n                        "type": "string"\n                    }\n                },\n                "required": [\n                    "text",\n                    "index",\n                    "logprobs",\n                    "finish_reason"\n                ],\n                "type": "object"\n            },\n            "type": "array"\n        },\n        "created": {\n            "type": "integer"\n        },\n        "id": {\n            "type": "string"\n        },\n        "model": {\n            "type": "string"\n        },\n        "object": {\n            "type": "string"\n        }\n    },\n    "type": "object"\n}\n\n\n```\n\n</details>\n')),(0,a.kt)("p",null,"We will configure it to use the body of the http request as the content the schema above."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Parse JSON",src:n(52679).Z,width:"1258",height:"750"})),(0,a.kt)("h2",{id:"configure-azure-communication-services-sms"},"Configure Azure Communication Services SMS"),(0,a.kt)("p",null,"Finally, we will configure our SMS connector for Azure Communication Services to respond with the new response generated by Azure OpenAI. You will need a connection string for your Azure Communication Services resource to initialize the SMS connector."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"SMS Connector",src:n(44369).Z,width:"1030",height:"1013"})),(0,a.kt)("p",null,"Now that everything is connected, test the flow by sending an SMS from your phone to the phone number you acquired through the Azure Communication Services resource."),(0,a.kt)("h2",{id:"next-steps-and-resources"},"Next Steps and Resources"),(0,a.kt)("p",null,"Congratulations! You have created a conversational SMS bot using Power Automate. Azure Communication Services provides out of the box connectors for SMS, Email and Chat. Whether it is having Anton, the personal trainer bot talk to your customers or having a real person interact with them, Azure Communication Services can help. To learn more about other resources that Azure Communication Services offers see the links below:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-open-ai-overview"},"Overview")," of Azure Communication Services."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-sms-connector"},"SMS Connector")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-email-connector"},"Email Connector")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-chat-connector"},"Chat Connector")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/acs-identity-connector"},"Identity Connector")),(0,a.kt)("li",{parentName:"ul"},"Want to learn how to do this in code, checkout out ",(0,a.kt)("a",{parentName:"li",href:"https://techcommunity.microsoft.com/t5/azure-communication-services/build-a-conversational-sms-bot-with-azure-communication-services/ba-p/3739568"},"last blog post"),".")),(0,a.kt)("p",null,"Also consider -"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Signing up for the free ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/lowcode-february/devplan"},"Power Apps Developer Plan")," so you have access to the Power Platform."),(0,a.kt)("li",{parentName:"ul"},"Enrolling in the ",(0,a.kt)("a",{parentName:"li",href:"https://aka.ms/lowcode-february/challenge"},"Cloud Skills Challenge")," to skill up on key cloud technologies with free, self-guided learning courses, and start climbing the leaderboard!")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Campaign Banner",src:n(24849).Z,width:"1334",height:"560"})))}p.isMDXComponent=!0},29535:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/01-acs_sms_compose_prompt-1ae5fcf3a8575e67273ffec86e125a97.png"},94847:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/01-acs_sms_event_grid-95865cc5d811fe7ea1a588000c3172b6.png"},52679:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/01-acs_sms_parse_json-c1d64ee28e2e9ea348cc7ab4181cb0f6.png"},44369:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/01-acs_sms_sms_connector-5629130701109cac2b8add9e5807dde0.png"},76158:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/01-anton_demo-2d6f639be708a190f0ead0c4e1d25a97.gif"},37281:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/30-22-16fe03bc77bbb554ef6b40090fb6e3c4.png"},24849:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/30-banner-d9bab2b92d758942447a4cbc50aef715.png"}}]);